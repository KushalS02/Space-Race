#include "music.h"

static int currentNote = 0;

const noteType mainSong[] = {

  /* {frequency, duration} */

  /* OPTION 3 */
    {262, 5},
    {262, 5},
    {294, 7},
    {294, 7},
    {330, 9},
    {330, 9},
    {349, 11},
    {349, 11},
    {392, 8},
    {262, 5},
    {262, 5},
    {294, 7},
    {294, 7},
    {330, 9},
    {330, 9},
    {349, 11},
    {349, 11},
    {392, 8},
    {440, 3},
    {440, 3},
    {392, 8},
    {392, 8},
    {349, 11},
    {349, 11},
    {330, 9},
    {330, 9},
    {294, 7},
    {440, 3},
    {440, 3},
    {392, 8},
    {392, 8},
    {349, 11},
    {349, 11},
    {330, 9},
    {330, 9},
    {294, 7},
    {262, 5},
    {262, 5},
    {196, 5},

    /* OPTION 2 */
    {523, 5},  
    {587, 6},  
    {659, 9},  
    {784, 10},  
    {1046, 6},  
    {784, 10},  
    {1046, 6},  
    {784, 10},  
    {1046, 6},  
    {784, 10},  
    {1046, 6},  
    {784, 10},  
    {1046, 6},  
    {659, 9},  
    {523, 5},  
    {659, 9},  
    {523, 5},  
    {659, 9},  
    {523, 5},  
    {659, 9},  
    {523, 5},  
    {587, 6},  
    {659, 9},  
    {587, 6},  
    {659, 9},  
    {587, 6},  
    {659, 9},  
    {587, 6},  
    {523, 5},  
    {587, 6},  
    {523, 5},  
    {587, 6},  
    {523, 5},  
    {587, 6},  
    {523, 5},

    /* OPTION 1 */
    { 698, 3 },
    { 587, 6 },
    { 698, 3 },
    { 587, 6 },
    { 698, 3 },
    { 587, 6 },
    { 698, 3 },
    { 587, 6 },
    { 523, 6 },
    { 440, 7 },
    { 523, 5 },
    { 440, 7 },
    { 523, 5 },
    { 440, 7 },
    { 523, 5 },
    { 440, 7 },
    { 392, 8 },
    { 330, 6 },
    { 392, 8 },
    { 330, 6 },
    { 392, 8 },
    { 330, 6 },
    { 392, 8 },
    { 330, 6 },
    { 294, 4 },
    { 247, 5 },
    { 294, 4 },
    { 247, 5 },
    { 294, 4 },
    { 247, 5 },
    { 294, 4 },
    { 247, 5 },
    { 698, 3 },
    { 587, 5 },
    { 698, 3 },
    { 587, 6 }

} ;

void startMusic() {

  int sustain = 8;

  int volume = 10;

    setEnvelope(triangleInvPeriod, sustain);

    enableChannel(channelA, true, false);

    setVolume(channelA, volume);

}

bool updateMusic(UINT32 timeElapsed) {

    bool updated = false;

    if (timeElapsed >= mainSong[currentNote].duration) {

        currentNote++;

        updated = true;

    }

    if (currentNote > (NOTES_SIZE - 1)) {

        currentNote = 0;

    }

    setTone(channelA, mainSong[currentNote].frequency);

    return updated;

}