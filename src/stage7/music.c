#include "music.h"

static int currentNote = 0;

const noteType mainSong[] = {

  /* {frequency, duration} */
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 },
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 },
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 },
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 },
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 },
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 },
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 },
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 698, 5 }, 
    { 587, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 523, 5 }, 
    { 440, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 392, 5 }, 
    { 330, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 }, 
    { 294, 5 }, 
    { 247, 5 } 


} ;

void startMusic() {

  int sustain = 10;

  int volume = 11;

    setEnvelope(triangleInvPeriod, sustain);

    enableChannel(channelA, true, false);

    setVolume(channelA, volume);

}

bool updateMusic(UINT32 timeElapsed) {

    bool updated = false;

    if (timeElapsed >= mainSong[currentNote].duration) {

        currentNote++;

        updated = true;

    }

    if (currentNote > (NOTES_SIZE - 1)) {

        currentNote = 0;

    }

    setTone(channelA, mainSong[currentNote].frequency);

    return updated;

}