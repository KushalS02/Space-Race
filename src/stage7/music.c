#include "music.h"

static int currentNote = 0;

const noteType mainSong[] = {

    {201, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {239, 15},
  {0,   5},
  {201, 7},
  {0,   13},
  {201, 5},
  {0,   5},
  {201, 5},
  {0,   5},
  {201, 5},
  {0,   5},
  {0,   10},
  {239, 15},
  {0,   25},
/* bar 2 (21 lines) */
  {201, 7},
  {0,   3},
  {213, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {213, 7},
  {0,   3},
  {179, 15},
  {0,   5},
  {201, 7},
  {0,   13},
  {169, 5},
  {0,   5},
  {169, 5},
  {0,   5},
  {169, 5},
  {0,   5},
  {0,   10},
  {179, 15},
  {0,   25},
/* bar 3 (21 lines) */
  {201, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {239, 15},
  {0,   5},
  {201, 7},
  {0,   13},
  {201, 5},
  {0,   5},
  {201, 5},
  {0,   5},
  {201, 5},
  {0,   5},
  {0,   10},
  {239, 15},
  {0,   25},
/* bar 4 (21 lines) */
  {201, 7},
  {0,   3},
  {213, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {213, 7},
  {0,   3},
  {179, 15},
  {0,   5},
  {201, 7},
  {0,   13},
  {169, 5},
  {0,   5},
  {169, 5},
  {0,   5},
  {169, 5},
  {0,   5},
  {0,   10},
  {179, 15},
  {0,   25},
/* bar 5 (23 lines) */
  {201, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {201, 7},
  {0,   3},
  {239, 15},
  {0,   5},
  {201, 7},
  {0,   13},
  {201, 5},
  {0,   5},
  {201, 5},
  {0,   5},
  {201, 5},
  {0,   5},
  {0,   10},
  {239, 15},
  {0,   5},
  {239, 5},
  {0,   5},
  {239, 5},
  {0,   5},
/* bar 6 (25 lines) */
  {201, 5},
  {239, 5},
  {201, 5},
  {239, 5},
  {201, 5},
  {169, 5},
  {201, 5},
  {169, 5},
  {127, 15},
  {0,   5},
  {201, 7},
  {0,   13},
  {127, 5},
  {0,   5},
  {127, 5},
  {0,   5},
  {127, 5},
  {0,   5},
  {0,   10},
  {119, 15},
  {0,   5},
  {179, 10},
  {239, 10},
/* bar 7 (23 lines) */
  {179, 7},
  {0,   3},
  {179, 7},
  {0,   3},
  {179, 7},
  {0,   3},
  {179, 7},
  {0,   3},
  {150, 15},
  {0,   5},
  {179, 7},
  {0,   13},
  {134, 5},
  {0,   5},
  {134, 5},
  {0,   5},
  {134, 5},
  {0,   5},
  {0,   10},
  {179, 15},
  {0,   5},
  {201, 15},
  {0,   5},
/* bar 8 (27 lines) */
  {201, 5},
  {239, 5},
  {201, 5},
  {239, 5},
  {201, 5},
  {169, 5},
  {201, 5},
  {169, 5},
  {134, 15},
  {0,   5},
  {201, 7},
  {0,   13},
  {127, 5},
  {135, 5},
  {127, 5},
  {135, 5},
  {159, 5},
  {142, 5},
  {127, 5},
  {119, 5},
  {100, 5.666},
  {0,   1},
  {89,  5.666},
  {0,   1},
  {71,  5.666},
  {0,   1},
  {100, 20}

} ;

void startMusic() {

    setEnvelope(triangleInvPeriod, 10);
    enableChannel(channelC, true, false);
    setVolume(channelC, 11);

}

bool updateMusic(UINT32 timeElapsed) {

    bool updated = false;

    if (timeElapsed >= mainSong[currentNote].duration) {

        currentNote++;

        updated = true;

    }

    if (currentNote > (NOTES_SIZE - 1)) {

        currentNote = 0;

    }

    setTone(channelC, mainSong[currentNote].frequency);

    return updated;

}